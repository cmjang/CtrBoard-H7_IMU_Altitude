<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM32Cube: Use STM32CubeMX in MDK Projects</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="$extra_stylesheet" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><img alt="Logo" src="armkeil_white_h.png"/></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">STM32Cube
   &#160;<span id="projectnumber">Version 2.0</span>
   </div>
   <div id="projectbrief">Create Projects for STM32H7 Series with STM32Cube HAL and STM32CubeMX</div>
  </td>
  <!--END !PROJECT_NAME-->
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="Compnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('cubemx_using.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Use STM32CubeMX in MDK Projects </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="proj_creation"></a>
Project creation</h1>
<p >There are different workflows depending on the device that you select:</p><ul>
<li><a class="el" href="cubemx_using.html#cubemx_proj">Create new single-core/non-TrustZone project</a> explains how to use MDK and STM32CubeMX for single-core devices or for Armv8-M based devices that have TrustZone disabled.</li>
<li><a class="el" href="cubemx_using.html#cubemx_multiproj">Create new multi-core/TrustZone project</a> shows how to use MDK and STM32CubeMX for multi-core devices or Armv8-M devices using TrustZone.</li>
</ul>
<h2><a class="anchor" id="cubemx_proj"></a>
Create new single-core/non-TrustZone project</h2>
<p >The following steps explain how to create a new MDK project based on a single-core STM32 device.</p>
<ul>
<li>Open µVision.</li>
<li>From the menu, select <b>Project - New µVision project</b>. Choose any name and location.</li>
<li>Select your target device. If you have many device family packs installed, the search field helps you to find a device quickly: <div class="image">
<img src="uv_select_sc_device.png" alt=""/>
</div>
</li>
<li>The <b>Manage Run-Time Environment</b> window opens.</li>
<li>[Required for TrustZone devices] Close it by clicking <b>OK</b>.</li>
<li>[Required for TrustZone devices] Go to <b>Project - Options for Target 'Target 1'... (Alt+F7).</b> A new window opens.</li>
<li>[Required for TrustZone devices] Set the Software Model to "TrustZone disabled": <div class="image">
<img src="uv_set_sw_model.png" alt=""/>
</div>
</li>
<li>[Required for TrustZone devices] Click <b>OK</b> to close the dialog.</li>
<li>[Required for TrustZone devices] Go to <b>Project - Manage - Run-Time Environment</b> to open this window.</li>
<li>[Optional] Switch the component bundle for the component class <b>Device</b> to 'STM32CubeMX' by selecting it from the drop down list in the 'Variant' column.</li>
<li>Select <b>Device:STM32Cube Framework:STM32CubeMX</b> to trigger the integration of the Cube HAL into your project: <div class="image">
<img src="uv_rte_sel_sc_cubemx.png" alt=""/>
</div>
</li>
<li>Press <b>Resolve</b> to satisfy all missing dependencies. This ensures that all required components will be added to your project.</li>
<li>Press <b>OK</b> to close the dialog.</li>
<li>A dialog opens asking to launch STM32CubeMX. Click on “Start STM32CubeMX” and wait until the STM32CubeMX GUI is opened: <div class="image">
<img src="open_sc_generator.png" alt=""/>
</div>
</li>
<li>[Required for TrustZone devices] After startup, an STM32CubeMX pop up window appears asking you about TrustZone. Select "without TrustZone enabled": <div class="image">
<img src="CubeMX_tz_config.png" alt=""/>
</div>
</li>
</ul>
<p >Continue with <a class="el" href="cubemx_using.html#cubemx_sys_config">System and Pin Configuration</a>.</p>
<h2><a class="anchor" id="cubemx_multiproj"></a>
Create new multi-core/TrustZone project</h2>
<p >The following steps explain how to create a new MDK project for a dual-core or an Armv8-M-based STM32 device with TrustZone enabled.</p>
<ul>
<li>Create a folder for the multi-project workspace. Choose any folder name.</li>
<li>Create sub-folders for the separate projects using names as shown in this table: <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Core   </th><th class="markdownTableHeadNone">Project folder name    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">STM32H7/Cortex-M4   </td><td class="markdownTableBodyNone"><b>CM4</b>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">STM32H7/Cortex-M7   </td><td class="markdownTableBodyNone"><b>CM7</b>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">STM32L5/Secure   </td><td class="markdownTableBodyNone"><b>Secure</b>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">STM32L5/Non-Secure   </td><td class="markdownTableBodyNone"><b>NonSecure</b>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">STM32U5/Secure   </td><td class="markdownTableBodyNone"><b>Secure</b>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">STM32U5/Non-Secure   </td><td class="markdownTableBodyNone"><b>NonSecure</b>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">STM32WL/Cortex-M0+   </td><td class="markdownTableBodyNone"><b>CM0PLUS</b>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">STM32WL/Cortex-M4   </td><td class="markdownTableBodyNone"><b>CM4</b>   </td></tr>
</table>
</li>
<li>Open µVision to create a project for one of the cores or one of the security modes.</li>
<li>From the menu, select <b>Project - New µVision project</b>. Choose any project name. Save the project in the appropriate sub-folder.</li>
<li>Select your target device. If you have many device family packs installed, the search field helps you to find a device quickly: <div class="image">
<img src="uv_select_dc_device0.png" alt=""/>
</div>
</li>
<li>The <b>Manage Run-Time Environment</b> window opens.</li>
<li>[Required for TrustZone devices] Close it by clicking <b>OK</b>.</li>
<li>[Required for TrustZone devices] Go to <b>Project - Options for Target 'Target 1'... (Alt+F7).</b> A new window opens.</li>
<li>[Required for TrustZone devices] Set the Software Model to the appropriate model.</li>
<li>[Required for TrustZone devices] Click <b>OK</b> to close the dialog.</li>
<li>[Required for TrustZone devices] Go to <b>Project - Manage - Run-Time Environment</b> to open this window.</li>
<li>[Optional] Switch the component bundle for the component class <b>Device</b> to 'STM32CubeMX' by selecting it from the drop down list in the 'Variant' column.</li>
<li>Select <b>Device:STM32Cube Framework:STM32CubeMX</b> to trigger the integration of the Cube HAL into your project: <div class="image">
<img src="uv_rte_sel_cubemx.png" alt=""/>
</div>
</li>
<li>Press <b>Resolve</b> to satisfy all missing dependencies. This ensures that all required components will be added to your project.</li>
<li>Press <b>OK</b> to close the dialog.</li>
<li>A dialog opens asking to launch STM32CubeMX. Click on “Start STM32CubeMX” and wait until the STM32CubeMX GUI is opened: <div class="image">
<img src="open_generator.png" alt=""/>
</div>
</li>
<li>[Required for TrustZone devices] After startup, an STM32CubeMX pop up window appears asking you about TrustZone. Select as required for the project.</li>
<li>[Required for STM32WL devices] After startup, an STM32CubeMX pop up window appears asking you about the nature of the project. Select "as Dual core project": <div class="image">
<img src="CubeMX_dc_config.png" alt=""/>
</div>
</li>
</ul>
<p >Continue with <a class="el" href="cubemx_using.html#cubemx_sys_config">System and Pin Configuration</a>.</p>
<h1><a class="anchor" id="cubemx_sys_config"></a>
System and Pin Configuration</h1>
<ul>
<li>The STM32CubeMX window shows your selected device (1): <div class="image">
<img src="CubeMX_new.png" alt=""/>
</div>
</li>
<li>Anytime, use <b>Help</b> [F1] to get access to the STM32CubeMX user manual.</li>
<li>[Optional] For devices with Arm TrustZone (for example STM32L5), you need to select to use or dismiss TrustZone at the first start of the new project. This selection cannot be undone.</li>
<li>Click on <b>System Core</b> (2) to see configuration options for:<ul>
<li>DMA</li>
<li>GPIO</li>
<li>ICACHE</li>
<li>NVIC and others</li>
</ul>
</li>
<li>Configure these interfaces as required by your application or set our in example projects.</li>
<li>Use the <b>Pinout view</b> to configure all necessary I/O pins to the required functions.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The configuration for dual-core devices and devices with enabled TZ is done for both cores/zones. You can configure which core/zone will use an individual peripheral. If a peripheral is used by both cores/zones, you must configure which core initializes the peripheral: <div class="image">
<img src="CubeMX_dc_clock_config.png" alt=""/>
</div>
</dd></dl>
<h1><a class="anchor" id="cubemx_conn_config"></a>
Connectivity Configuration</h1>
<ul>
<li>Click on <b>Connectivity</b> (3) to see configuration options for the on-chip peripherals, such as:<ul>
<li>I2C</li>
<li>LPUART</li>
<li>UART</li>
<li>SPI and others</li>
</ul>
</li>
<li>Configure these interfaces as required by your application or set our in example projects.</li>
<li>For peripherals that are supported by CMSIS-Drivers, make sure to configure the correct number (refer to the CMSIS-Driver of your selected device that contains the information about the correlation between peripheral and driver number).</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The configuration for dual-core devices and devices with enabled TZ is done for both cores/zones. You can configure which core/zone will use an individual peripheral. If a peripheral is used by both cores/zones, you must configure which core initializes the peripheral: <div class="image">
<img src="CubeMX_dc_connectivity.png" alt=""/>
</div>
</dd></dl>
<h1><a class="anchor" id="cubemx_clock_config"></a>
Clock Configuration</h1>
<ul>
<li>On the <b>Clock Configuration</b> tab, adjust the clock to the desired settings: <div class="image">
<img src="CubeMX_clock_config.png" alt=""/>
</div>
</li>
</ul>
<h1><a class="anchor" id="cubemx_code_gen"></a>
Generate Code</h1>
<p >Before generating the code, set the appropriate options:</p><ul>
<li>Go to the <b>Project Manager</b> (1) tab.</li>
<li>Click on <b>Code Generator</b> (2).<ul>
<li>Usually, select <em>Add necessary library files as reference in the toolchain project configuration file</em>.</li>
<li><b> Do not enable</b> <em>Generate peripheral initialization as a pair of '.c/.h' files per peripheral</em> as this is not supported: <div class="image">
<img src="CubeMX_code_generator_setting.png" alt=""/>
</div>
</li>
</ul>
</li>
<li>[Optional] Click on <b>Advanced Settings</b> (3) to enable/disable the generation of function calls as required by your application/example project.</li>
<li>Use the <b>Generate Code</b> (4) button to run the STM32CubeMX code generation.</li>
<li><b>Close</b> the dialog that confirms the end of the generation and switch back to µVision.</li>
<li>Click <b>OK</b> to close the <b>Manage Run-Time Environment</b> window and confirm to import changes: <div class="image">
<img src="uv_import.png" alt=""/>
</div>
</li>
</ul>
<p >In case you need to change the configuration of your device, use the button in the <b>Manage Run-Time Environment</b> window to launch STM32CubeMX: </p><div class="image">
<img src="MDK_RTE_Run_gen.png" alt=""/>
</div>
<h1><a class="anchor" id="cubemx_multiproj2"></a>
[Optional] Create additional multi-core/TrustZone project</h1>
<p >The following steps explain how to create an additional MDK project for a dual-core or an Armv8-M-based STM32 device with TrustZone enabled. The first project was created in <a class="el" href="cubemx_using.html#cubemx_multiproj">Create new multi-core/TrustZone project</a>. Now, go to the other project folder and follow these steps:</p>
<ul>
<li>Open µVision to create a project for the other core or security mode.</li>
<li>From the menu, select <b>Project - New µVision project</b>. Choose any project name. Save the project in the appropriate sub-folder.</li>
<li>Select your target device. If you have many device family packs installed, the search field helps you to find a device quickly: <div class="image">
<img src="uv_select_dc_device1.png" alt=""/>
</div>
</li>
<li>The <b>Manage Run-Time Environment</b> window opens.</li>
<li>[Optional for TrustZone devices] Close it by clicking <b>OK</b>.</li>
<li>[Optional for TrustZone devices] Go to <b>Project - Options for Target 'Target 1'... (Alt+F7).</b> A new window opens.</li>
<li>[Optional for TrustZone devices] Set the Software Model to the appropriate model.</li>
<li>[Optional for TrustZone devices] Click <b>OK</b> to close the dialog.</li>
<li>[Optional for TrustZone devices] Go to <b>Project - Manage - Run-Time Environment</b> to open this window.</li>
<li>[Optional] Switch the component bundle for the component class <b>Device</b> to 'STM32CubeMX' by selecting it from the drop down list in the 'Variant' column.</li>
<li>Select <b>Device:STM32Cube Framework:STM32CubeMX</b> to trigger the integration of the Cube HAL into your project: <div class="image">
<img src="uv_rte_sel_cubemx.png" alt=""/>
</div>
</li>
<li>Press <b>Resolve</b> to satisfy all missing dependencies. This ensures that all required components will be added to your project.</li>
<li>Press <b>OK</b> to close the dialog.</li>
<li>As the STM32CubeMX device configuration was already done in <a class="el" href="cubemx_using.html#cubemx_multiproj">step one</a>, all CubeMX files will be automatically synchronized in uVision. Thus, no new instance of STM32CubeMX is opened.</li>
<li>If required, the device can be re-configured in STM32CubeMX at any time. Open STM32CubeMX from any of the µVision projects (via the “play” button in the Manage Run-Time Environment window). The re-generated files will be automatically synchronized in both µVision projects.</li>
</ul>
<h1><a class="anchor" id="uv_proj_overview"></a>
µVision Project Overview</h1>
<p >The C code generated by STM32CubeMX covers the initialization of the MCU peripherals using the STM32Cube firmware libraries. STM32CubeMX creates a source group in your project called <b>STM32CubeMX:Common Sources</b>. This group contains three files that contain user-dedicated sections allowing to insert user-defined C code:</p>
<div class="image">
<img src="MDK_project_files.png" alt=""/>
</div>
<p ><b>main.c</b> is used to:</p><ul>
<li>Resetting the MCU to a known state by calling the HAL_init() function that resets all peripherals, initializes the Flash memory interface and the SysTick.</li>
<li>Configuring and initializing the system clock.</li>
<li>Configuring and initializing the GPIOs that are not used by peripherals.</li>
<li>Defining and calling, for each configured peripheral, a peripheral initialization function that defines a handle structure that will be passed to the corresponding peripheral HAL init function which in turn will call the peripheral HAL MSP initialization function.</li>
</ul>
<p ><b>stm32l4xx_it.c</b> contains the generated interrupt handlers. The column “Generate IRQ Handler” in STM32CubeMX NVIC settings allows controlling whether the interrupt handler function call shall be generated or not.</p>
<p ><b>stm32l4xx_it.h</b> is the associated header file.</p>
<h1><a class="anchor" id="cubemx_proj_rtx5"></a>
[Optional] Add and Configure Keil RTX5</h1>
<p >The following steps are a recommendation on how to integrate Keil RTX5 in a project that is configured with STM32CubeMX.</p>
<ul>
<li>In µVision, open the <b>Manage Run-Time Environment</b> window and select <b>CMSIS:RTOS2 (API):Keil RTX5</b> from the list of available software components. Select the “Source” variant: <div class="image">
<img src="uv_sel_rtx5.png" alt=""/>
</div>
</li>
<li>Open STM32CubeMX, as described in <a class="el" href="cubemx_using.html#cubemx_code_gen">Generate Code</a>.</li>
<li>In STM32CubeMX, open the <b>(1) Pinout &amp; Configuration</b> tab, click on <b>(2) System Core</b> and then click on <b>(3) NVIC</b>. Switch to the <b>(4) Code generation</b> tab and under <b>(5) Generate IRQ handler</b> disable:<ul>
<li>System service call via SWI instruction</li>
<li>Pendable request for system service</li>
<li>Time base: System tick timer <div class="image">
<img src="CubeMX_NVIC_RTX5.png" alt=""/>
</div>
</li>
</ul>
</li>
<li>Open <code>main.c</code> in the μVision editor. Find the <code>USER</code> <code>CODE</code> includes and add the <code>cmsis_os2.h</code> header. <div class="fragment"><div class="line"><span class="comment">/* USER CODE BEGIN Includes */</span></div>
<div class="line"><span class="preprocessor">  #include &quot;RTE_Components.h&quot;</span>             </div>
<div class="line"><span class="preprocessor">  #ifdef RTE_Compiler_EventRecorder</span></div>
<div class="line"><span class="preprocessor">    #include &quot;EventRecorder.h&quot;</span>            </div>
<div class="line"><span class="preprocessor">  #endif  </span></div>
<div class="line"><span class="preprocessor">  #include &quot;cmsis_os2.h&quot;</span> </div>
<div class="line">  <span class="keyword">extern</span> <span class="keywordtype">void</span> app_main (<span class="keywordtype">void</span>* arg); </div>
<div class="line"><span class="comment">/* USER CODE END Includes */</span></div>
</div><!-- fragment --></li>
<li>Find the following code sequence near <code>main()</code>: <div class="fragment"><div class="line"><span class="comment">/* USER CODE BEGIN 0 */</span> </div>
<div class="line"> </div>
<div class="line"><span class="comment">/* USER CODE END 0 */</span></div>
</div><!-- fragment --></li>
<li>Add the following code: <div class="fragment"><div class="line"><span class="comment">/* USER CODE BEGIN 0 */</span> </div>
<div class="line"><span class="comment">/* Override default HAL_GetTick function */</span></div>
<div class="line">uint32_t HAL_GetTick (<span class="keywordtype">void</span>) { </div>
<div class="line">  <span class="keyword">static</span> uint32_t ticks = 0U; </div>
<div class="line">  uint32_t i; </div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span> (osKernelGetState () == osKernelRunning) { </div>
<div class="line">    <span class="keywordflow">return</span> ((uint32_t)osKernelGetTickCount ()); </div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* If Kernel is not running wait approximately 1 ms then increment and return auxiliary tick counter value */</span> </div>
<div class="line">  <span class="keywordflow">for</span> (i = (SystemCoreClock &gt;&gt; 14U); i &gt; 0U; i--) { </div>
<div class="line">    __NOP(); __NOP(); __NOP(); __NOP(); __NOP(); __NOP(); __NOP(); __NOP(); __NOP(); __NOP(); __NOP(); __NOP(); </div>
<div class="line">  } </div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> ++ticks; </div>
<div class="line">} </div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Override default HAL_InitTick function */</span></div>
<div class="line">HAL_StatusTypeDef HAL_InitTick(uint32_t TickPriority) { </div>
<div class="line"> </div>
<div class="line">  UNUSED(TickPriority); </div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> HAL_OK; </div>
<div class="line">} </div>
<div class="line"><span class="comment">/* USER CODE END 0 */</span></div>
</div><!-- fragment --></li>
<li>Repeat for user code 2 sequence inside <code>main()</code>: <div class="fragment"><div class="line"><span class="comment">/* USER CODE BEGIN 2 */</span> </div>
<div class="line"> </div>
<div class="line"><span class="comment">/* USER CODE END 2 */</span></div>
</div><!-- fragment --></li>
<li>Replace with: <div class="fragment"><div class="line"><span class="comment">/* USER CODE BEGIN 2 */</span></div>
<div class="line"><span class="preprocessor">  #ifdef RTE_Compiler_EventRecorder</span></div>
<div class="line">    EventRecorderInitialize(EventRecordAll, 1);</div>
<div class="line"><span class="preprocessor">  #endif  </span></div>
<div class="line">  SystemCoreClockUpdate();</div>
<div class="line">  osKernelInitialize();                 <span class="comment">// Initialize CMSIS-RTOS</span></div>
<div class="line">  osThreadNew(app_main, NULL, NULL);    <span class="comment">// Create application main thread</span></div>
<div class="line">  osKernelStart();     </div>
<div class="line"><span class="comment">/* USER CODE END 2 */</span></div>
</div><!-- fragment --></li>
<li>Create a new source file in your project called <b>app_main.c</b> and add the following content: <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;cmsis_os2.h&quot;</span>                  <span class="comment">// ::CMSIS:RTOS2</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> app_main (<span class="keywordtype">void</span> <span class="keyword">const</span>* arg) {</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">while</span>(1) {</div>
<div class="line">    ...</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ul>
<p >STM32CubeMX generated code and HAL initialization is now isolated in the <code>main.c</code> module. Feel free to extend <code>app_main.c</code> with your user code instead.</p>
<h1><a class="anchor" id="cubemx_proj_tips"></a>
Tips, Tricks and Pitfalls</h1>
<p >When using µVision with STM32CubeMX, you should consider the following things:</p>
<ul>
<li>This document describes how to create projects for STM32 single-core Cortex-M devices. As explained above, always launch STM32CubeMX from the µVision window <b>Manage Run-Time Environment</b> with the 'Play' button under <b>Device:STM32Cube Framework (API):STM32CubeMX</b>. Only this ensures, that STM32CubeMX is launched with the right parameters for your project. Creating applications for STM32 dual-core Cortex-M devices works completely different. The 'Play' button is not available there. Please see <a href="https://developer.arm.com/documentation/kan338/latest" target="_blank">Application Note 338</a> for more details.<ul>
<li>STM32CubeMX creates its project file at this location: <div class="fragment"><div class="line">...\&lt;project&gt;\RTE\Device\&lt;Dname&gt;\STCubeGenerated\STCubeGenerated.ioc</div>
</div><!-- fragment --> Do <b>NOT</b> launch STM32CubeMX with this project file manually! Any changes in this project would not be synchronized with the µVision project!</li>
<li>STM32CubeMX creates a µVision project file at this location: <div class="fragment"><div class="line">...\&lt;project&gt;\RTE\Device\&lt;Dname&gt;\STCubeGenerated\MDK-ARM\STCubeGenerated.uvprojx</div>
</div><!-- fragment --> Do <b>NOT</b> launch µVision with this project file manually! Any changes in this project would not be synchronized with the original µVision project.</li>
</ul>
</li>
<li>Even if you have launched STM32CubeMX correctly from µVision, do <b>NOT</b> load any other STM32CubeMX project file (*.ioc) manually! This would override the path for the source files and µVision would fail to find the source files.</li>
<li>If you get compilation errors in <b>CMSIS driver</b> source files or in <b>STM32Cube HAL</b> source files you should check if the <b>Device Family Pack</b> is compatible with the installed <b>STM32Cube Firmware Package</b>. The compatible STM32Cube Firmware version is mentioned in the release notes of the Device Family Pack.<ul>
<li>Open the <b>Pack Installer</b> and select the device you are using in the left window.</li>
<li>When you hover the mouse over the pack name or the action button, you see the release notes of this pack. The compatible version of the STM32Cube firmware package is listed at the very top of this list. It is not guaranteed that newer versions of a STM32CubeMX firmware packages are always compatible with this Device Family Pack. <div class="image">
<img src="PackInstallerReleaseNotes.png" alt=""/>
</div>
</li>
<li>Check the version of the installed STM32CubeMX firmware package in the STM32CubeMX dialog <b>Help - Manage embedded software packages</b> <div class="image">
<img src="CubeMX_Packages.png" alt=""/>
</div>
</li>
</ul>
</li>
<li>Project Synchronization between µVision and STM32CubeMX:<ul>
<li>The µVision project and the STM32CubeMX project are synchronized via GPDSC file <div class="fragment"><div class="line">...\&lt;project&gt;\RTE\Device\&lt;Dname&gt;\FrameworkCubeMX.gpdsc</div>
</div><!-- fragment --> STM32CubeMX writes this file when the button <b>GENERATE CODE</b> is pressed and µVision reads this file when µVision gets the focus. Any source files that were added or removed by STM32CubeMX are automatically added/removed to/from the µVision project this way.</li>
<li>µVision creates the file <div class="fragment"><div class="line">...\&lt;project&gt;\RTE\Device\project.script</div>
</div><!-- fragment --> for the first launch of STM32Cube. After that, this file is not used anymore.</li>
</ul>
</li>
<li><p class="startli">When a project needs to be archived or when a project is shared in a team, we recommend to put all files of the whole project folder into a repository except:</p><ul>
<li>Listing files (*.lst) - these files are generated with every project build</li>
<li>Object files (*.o) - these files are generated with every project build</li>
<li>&lt;project&gt;.uvguix.&lt;UserName&gt; - this file only holds µVision GUI layout information for one user</li>
</ul>
<p class="startli">The <b>RTE</b> folder contains the source files from packs as well as all STM32CubeMX generated files. </p>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
	Copyright &copy; 2015-2022 Arm Limited (or its affiliates). All rights reserved.
	<!-- Use script below for auto-inserting date, project name, version, etc  -->
	<!-- <script type="text/javascript">
        writeFooter.call(this);
    </script> -->
    </li>
  </ul>
</div>
</body>
</html>
